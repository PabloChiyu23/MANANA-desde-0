<!DOCTYPE html>
<html>
<head>
  <title>Test Payment - MAÑANA</title>
  <style>
    body { font-family: Arial; padding: 40px; text-align: center; }
    button { background: #009EE3; color: white; padding: 20px 40px; font-size: 18px; border: none; border-radius: 10px; cursor: pointer; }
    button:hover { background: #0089c7; }
    #result { margin-top: 20px; padding: 20px; background: #f0f0f0; border-radius: 10px; }
  </style>
</head>
<body>
  <h1>Test de Pago - Activar Producción</h1>
  <p>Esto creará una preferencia de pago de $29 MXN para activar tu cuenta de Mercado Pago.</p>
  <button onclick="createPayment()">Crear Pago de Prueba</button>
  <div id="result"></div>

  <script>
    async function createPayment() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = 'Creando preferencia...';
      
      try {
        const response = await fetch('/api/create-preference', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            userId: 'test-onboarding-user',
            userEmail: 'test@test.com'
          })
        });
        
        const data = await response.json();
        console.log('Response:', data);
        
        if (data.initPoint) {
          resultDiv.innerHTML = `
            <p><strong>Preferencia creada!</strong></p>
            <p>ID: ${data.preferenceId}</p>
            <a href="${data.initPoint}" target="_blank" style="display:inline-block; margin-top:10px; background:#009EE3; color:white; padding:15px 30px; text-decoration:none; border-radius:8px;">
              Ir a Pagar en Mercado Pago
            </a>
            <p style="margin-top:15px; color:#666; font-size:12px;">
              Abre en ventana incógnita y paga con OTRA cuenta de Mercado Pago
            </p>
          `;
        } else {
          resultDiv.innerHTML = '<p style="color:red;">Error: ' + JSON.stringify(data) + '</p>';
        }
      } catch (error) {
        resultDiv.innerHTML = '<p style="color:red;">Error: ' + error.message + '</p>';
      }
    }
  </script>
</body>
</html>
